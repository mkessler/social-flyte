<% content_for :page_title do %>
  <h2 class="dashboard-title">
    Profile
    <%= link_to request.referrer, class: 'btn-floating btn-small mr-0' do %>
      <i class="fa fa-reply" aria-hidden="true" data-toggle="tooltip" title="Back"></i>
    <% end %>
  </h2>
<% end %>

<% if current_user.invitations.pending.any? %>
  <% current_user.invitations.pending.each do |invitation| %>
    <div class="row">
      <div class="groala-alert col-lg-12 mb-3">
        <div class="card purple lighten-1 accent-4 text-xs-center z-depth-1">
          <div class="card-block">
            <span class="white-text">
              <i class="fa fa-envelope-open-o fa-lg fa-fw"></i>
              You've been invited to join <b><%= invitation.organization.name%></b>
              <%= render 'invitations/accept_form', organization: invitation.organization, invitation: invitation %>
            </span>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>

<div class="row">
  <div class="col-lg-12 mb-3">
    <ul class="nav nav-tabs tabs-1 light-blue darken-2" role="tablist">
      <li class="nav-item">
        <%= link_to '#edit-profile', class: 'nav-link active', role: 'tab', data: { toggle: 'tab' } do %>
          <i class="fa fa-pencil" aria-hidden="true"></i> Edit
        <% end %>
      </li>
    </ul>

    <div class="tab-content card">
      <div class="tab-pane fade in active" id="edit-profile" role="tabpanel">
        <%= simple_form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
          <%= f.error_notification %>

          <br>
          <h5 class="text-xs-center">User Info</h5>
          <br>

          <div class="form-inputs">
            <div class="row">
              <div class="col-md-6">
                <%= f.input :first_name, icon: 'user' %>
              </div>
              <div class="col-md-6">
                <%= f.input :last_name, icon: 'user' %>
              </div>
            </div>
            <br>
            <%= f.input :email, required: true, icon: 'envelope' %>

            <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
              <p>Currently waiting confirmation for: <%= resource.unconfirmed_email %></p>
            <% end %>

            <br>
            <h5 class="text-xs-center">Update Password</h5>
            <br>

            <%= f.input :password, autocomplete: "off", required: false, icon: 'lock' %>
            <%= f.input :password_confirmation, required: false, icon: 'lock' %>

            <br>
            <h5 class="text-xs-center">Save Changes</h5>
            <br>

            <%= f.input :current_password, required: true, icon: 'unlock-alt' %>
          </div>

          <div class="form-actions text-xs-right">
            <%= f.button :button do %>
              <i class="fa fa-check-circle-o left" aria-hidden="true"></i>
              Submit
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6 mb-3">
    <ul class="nav nav-tabs tabs-1 light-blue darken-2" role="tablist">
      <li class="nav-item">
        <%= link_to '#connected-networks', class: 'nav-link active', role: 'tab', data: { toggle: 'tab' } do %>
          <i class="fa fa-globe" aria-hidden="true"></i> Connected Accounts
        <% end %>
      </li>
    </ul>

    <div class="tab-content card">
      <div class="tab-pane fade in active text-xs-center" id="connected-networks" role="tabpanel">
        <div class="groala-user-network" id="connected-facebook">
          <a type="button" class="btn-floating btn-large btn-fb"><i class="fa fa-facebook"></i></a>
          <span>Status: Checking <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i></span>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-3">
    <ul class="nav nav-tabs tabs-1 light-blue darken-2" role="tablist">
      <li class="nav-item">
        <%= link_to '#new-organization', class: 'nav-link active', role: 'tab', data: { toggle: 'tab' } do %>
          <i class="fa fa-plus" aria-hidden="true"></i> New Organization
        <% end %>
      </li>
    </ul>

    <div class="tab-content card">
      <div class="tab-pane fade in active" id="new-organization" role="tabpanel">
        Interested in adding a new organization? Get started below, now!
        <div class="text-xs-right mt-1">
          <%= link_to new_organization_path, class: 'btn green accent-4 waves-effect waves-light' do %>
            <i class="fa fa-plus" aria-hidden="true"></i> New Organization
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).on('ready', function() {
    window.fbAsyncInit = function() {
      App.authentications.facebook.init();
      App.authentications.facebook.status();
    }
    App.authentications.facebook.loadSDK();
    console.log('Facebook Authentication ready.');
  });
</script>
